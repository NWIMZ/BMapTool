<!DOCTYPE html>
<html>
	<head>
		<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
		<meta name="viewport" content="initial-scale=1.0, user-scalable=no" />
		<link rel="stylesheet" href="css/reset.css" />
		<link rel="stylesheet" href="css/public.css" />
		<style type="text/css">
			#allmap {
				width: 100%;
				height: 80%;
				overflow: hidden;
				margin: 0;
				font-family: "微软雅黑";
			}
		</style>
		<script type="text/javascript" src="http://api.map.baidu.com/api?v=2.0&ak=QPLZeSxBGuR6IEkbtEGchaREPTIUbELa"></script>
		<title>转百度坐标系</title>
	</head>
	<body>
		<div id="allmap"></div>
		<div id="ctrl">
			<p>
				<input type="text" placeholder="lng" id="pLng" value="113.70077" />
				<input type="text" placeholder="lat" id="pLat" value="23.034817" />
				<input type="button" value="转换" id="getAddress" />
			</p>
			<p id="result"></p>
		</div>
		<script src="js/zBmap.js"></script>
		<script type="text/javascript">
			// 百度地图API功能
			(function(){
				//地图初始化
				var map = new ZBMap("allmap");
				
				var oResult = document.getElementById("result");
				var oTranslate = document.getElementById("getAddress");
				var oLng = document.getElementById("pLng");
				var oLat = document.getElementById("pLat");
				oTranslate.addEventListener("click",function(){
					var lng = oLng.value;
					var lat = oLat.value;
					
					var rawPoint = new BMap.Point(lng, lat);
					map.addOverlay(rawPoint);
					var rawLabel = new BMap.Label("未转换的GPS坐标（原始）<br />lng:" + lng + "<br />lat:" + lat, {
						offset: new BMap.Size(20, -10)
					});
					var rawMarker = new BMap.Marker(rawPoint);
					map.addOverlay(rawMarker);
					rawMarker.setLabel(rawLabel);
					
					var pointArr = [];// 坐标数组
					pointArr.push(rawPoint);
					
					translateToBaidu(pointArr, map,function(points){
						var point = points[0];
						var marker = new BMap.Marker(point);
						map.addOverlay(marker);
						
						var label = new BMap.Label("转换后的百度坐标<br />" + "blng:" + point.lng + "<br />blat:" + point.lat, {
							offset: new BMap.Size(20, -10)
						});
						marker.setLabel(label); //添加百度label
						map.setCenter(point);
						
						var html = "blng:" + point.lng + "<br />blat:" + point.lat;
						oResult.innerHTML = html;
					});
				})
				
				function translateToBaidu(pointArr,map,cb){
					for(var i=0;i<pointArr.length;i++){
						var lng = pointArr[i].lng;
						var lat = pointArr[i].lat;
					}
					// 声明转换成功后的回调
					window.translateCallback = function(data){
						if(data.status === 0) {
							cb(data.points);
						}
					}
					// 转换
					var convertor = new BMap.Convertor();
					convertor.translate(pointArr, 1, 5, translateCallback)
				}
				
				
			})()
		
			
					
		</script>
	</body>
</html>
